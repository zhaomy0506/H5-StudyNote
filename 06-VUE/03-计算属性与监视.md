# 计算属性与监视

## 计算属性computed

计算属性: `computed`配置项,该配置项为一个对象

1. 定义: 要用的属性不存在,是根据已有的<span style="color:red">**属性**</span>计算得来的
2. 原理: 底层借助了`Object.definedProperty`方法提供的`getter`和`setter`实现
3. `getter`什么时候执行?
   1. 属性被初次读取时
   2. 当依赖的数据发生变化时

> *与methods相比,内部拥有缓存机制(方便复用),效率更高,调试方便*

**备注:**

1. 计算属性会出现在vm上,直接读取使用即可,**不是函数!**
2. 计算属性被修改,必须写setter去响应修改,且setter中要引起依赖的数据发生变化

计算属性的两种写法:

```js
//正常写法
computed: {
    fullName: {
        get() {
            return this.firstName + '-' + this.lastName
        },
        set(value) {
            console.log(value);
        }
    }
}
//简写形式
//只考虑读取,不考虑修改,可以把属性直接写成一个函数,无需配置单独配置getter
computed: {
	fullName() {
		return this.firstName + '-' + this.lastName
	}
}
```

## 监视属性watch

1. 当被监视的属性发生变化时,回调函数自动调用
2. 监视的属性必须存在,才能进行监视!
3. 监视的两种写法:
   - `new Vue`时传入`watch`配置项
   - 通过`vm.$watch(attr,{option})`监视

监视一个属性时,可以传入一些配置项:

| 配置项      | 类型   | 说明                                                         | 默认值 |
| ----------- | ------ | ------------------------------------------------------------ | ------ |
| `handler`   | 函数   | 监视回调函数，接收新值和旧值作为参数                         | 无     |
| `immediate` | 布尔值 | 表示是否在初始化时就触发handler函数                          | false  |
| `deep`      | 布尔值 | 表示是否深度监视属性，即如果属性是一个对象或数组，是否监视其内部的变化 | false  |

### 深度监视

1. vue中的watch默认不监测对象内部数据(一层)
2. 配置`deep:true`可以监测到对象内部的数据变化(多层)

> *vue自身可以监测对象内部值的改变,但是vue提供的watch配置项默认不可以*
>
> *使用watch根据数据的具体结构,来决定是否开启深度检测*

### 正常写法与简写形式

```js
//正常写法
watch:{
    fullName:{
        immediate:true,//初始化时触发
        deep:true,//深度监视
        handler(newValue,oldValue){ //监视到数据改变时触发该函数}
    }
}
//在不需要immediate和deep配置项时,可以简写
watch: {
    fullName(){}
}
```

## computed 和 watch 区别

computed可以完成的,watch都可以完成

watch能完成的功能,computed不一定可以完成,例如:watch可以进行异步操作

两个重要的原则:

1. 所有被Vue所管理的函数,最好写成普通函数,这样this的指向是vm或组件对象实例
2. 所有不被vue所管理的函数(定时器,ajax...),最好写成箭头函数,这样this才能指向vm

## Vue监视数据原理

1. Vue会监视data中所有层次的数据

2. 如何检测对象中的数据?

   通过setter实现监视,且要在new vue时就传入要监测的数据

   1. 对象中后追加的属性,Vue默认不做响应

   2. 如果后添加的属性要做响应式,使用如下API

      `Vue.set(target,propertyName/index,value)`

      `vm.$set(target,propertyName/index,value)`

3. 如何监测数组中的数据?

   通过包裹数据更新元素的方法实现,本质就是做了两件事

   1. 调用原生对应的方法对数组更新
   2. 重新解析模版,进而更新页面

4. 在Vue修改数组中的某个元素一定要使用如下方法

   1. 使用`push`、`pop`、`shift`、`unshift`、`splice`、`sort`、`reverse`这7个方法
   2. `Vue.set`或`vm.$set`

> `Vue.set`/`vm.$set`不能给vm或vm根数据添加属性
