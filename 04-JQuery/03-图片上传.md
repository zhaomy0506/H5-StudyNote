# 图片上传与预览

## 图片的预览

图片预览需要使用到:

1. `FileReader`构造函数

   使用`FileRader`文件阅读器,将`file`对象转换成`base64`格式字符编码

   - `.readAsDataURL()` 读取文件,转换成Base64格式的图片或文件
   - `.result` 读取的文件储存在该属性上
   - `.onload`事件 读取完成后触发该事件

2. `input.files`属性

   `input type="file" `时,上传的文件,存在自身的files属性(fileList数组),每一个下标对应的元素就是一个file对象

```js
let fr = new FileReader //创建文件阅读器实例
fr.readAsDataURL(文件变量) //指定读取的文件
fr.onload = function(){
    console.log(fr.result)//读取后的结果
}//当文件读取成功后触发该回调
```

## 图片上传

网络通信无法直接发送图片,需要转换为form-data格式

文件上传需要用到:

1. `FormData`构造函数,,可以储存form-data格式的数据
   - append() 像实例化对象中添加数据
     - 参数1 : 描述文件类型`"file"`,字符串
     - 参数2 : 文件变量


```js
//JQuery中有自己处理携带参数的逻辑,上传文件需要关闭
//processData:false 来关闭格式化参数
var fd = new FormData();
fd.append('file', file);
$.ajax({
	type: 'post',
	url: host + '/user/uploadAvatar',
	data: fd,
	contentType: false, // 根据类型自由设定
	processData: false,    // 关闭格式化参数
	headers: {
		Authorization: 'Bearer ' + localStorage.getItem('ccToken')
	},
	success: function (res) {
		console.log(res);// 回显图片 
		$('.bg .img-rounded').attr('src', host + res.data.avatar)
	}
})

```

